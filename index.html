<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ‘ãƒƒã‚¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    input {
      padding: 6px;
      font-size: 14px;
      margin-right: 10px;
      width: 100px;
    }
    label {
      font-weight: bold;
      margin-right: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background: #222;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    .result {
      white-space: pre-wrap;
      background: #fff;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    details {
      margin-top: 15px;
      background: #eee;
      padding: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>ãƒ‘ãƒƒã‚¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>

  <div>
    <label>ãƒ‘ãƒƒã‚¯ç·æ•°:</label>
    <input type="number" id="totalTickets" value="31900">
    <label>å½“ãŸã‚Šç¢ºç‡ï¼ˆ1/nï¼‰:</label>
    <input type="number" id="odds" value="319">
    <label>å½“ãŸã‚Šæ•°:</label>
    <input type="number" id="maxWins" value="100">
  </div>

  <button onclick="simulateLottery()">é–‹å§‹ã™ã‚‹ï¼</button>
  <div class="result" id="resultArea"></div>

  <script>
    function getSecureRandomInt(max) {
      const array = new Uint32Array(1);
      window.crypto.getRandomValues(array);
      return array[0] % max;
    }

    function simulateLottery() {
      const TOTAL_TICKETS = parseInt(document.getElementById("totalTickets").value);
      const ODDS = parseInt(document.getElementById("odds").value);
      const MAX_WINS = parseInt(document.getElementById("maxWins").value);

      let winRemaining = MAX_WINS;
      let winIndexesSet = new Set();
      let forceStartIndex = null;

      for (let i = 0; i < TOTAL_TICKETS; i++) {
        const currentTicket = i + 1;
        const ticketsLeft = TOTAL_TICKETS - i;

        if (winRemaining >= 1 && winRemaining === ticketsLeft) {
          if (forceStartIndex === null) {
            forceStartIndex = currentTicket;
          }
          winIndexesSet.add(currentTicket);
          winRemaining--;
          continue;
        }

        if (getSecureRandomInt(ODDS) === 0 && winRemaining > 0) {
          winIndexesSet.add(currentTicket);
          winRemaining--;
        }
      }

      let winIndexes = Array.from(winIndexesSet).sort((a, b) => a - b);

      let intervals = [];

      if (winIndexes.length > 0) {
        const firstInterval = winIndexes[0] - 1;
        if (firstInterval > 0) intervals.push(firstInterval);
      }

      for (let i = 1; i < winIndexes.length; i++) {
        const diff = winIndexes[i] - winIndexes[i - 1];
        if (diff > 0) intervals.push(diff);
      }

      if (winIndexes.length > 0) {
        const lastInterval = TOTAL_TICKETS - winIndexes[winIndexes.length - 1];
        if (lastInterval > 0) intervals.push(lastInterval);
      }

      const minInterval = intervals.length > 0 ? Math.min(...intervals) : null;
      const maxInterval = intervals.length > 0 ? Math.max(...intervals) : null;

      let forcedWinCount = 0;
      if (forceStartIndex !== null) {
        forcedWinCount = winIndexes.filter(n => n >= forceStartIndex).length;
      }

      let resultText = `ğŸ’¡ å½“ãŸã‚Šã®ç·æ•°: ${winIndexes.length} / ${MAX_WINS}\n`;
      resultText += winIndexes.length > 0 ? `ğŸ¯ æœ€åˆã®å½“ãŸã‚Š: ${winIndexes[0]} å£ç›®\n` : "ğŸ’¥ å½“ãŸã‚Šãªã—\n";

      if (intervals.length > 0) {
        resultText += `â±ï¸ æœ€çŸ­ã®å½“ãŸã‚Šé–“éš”ï¼ˆé–‹å§‹å‰ãƒ»çµ‚äº†å¾Œã‚‚å«ã‚€ï¼‰: ${minInterval} å£\n`;
        resultText += `ğŸ¢ æœ€é•·ã®å½“ãŸã‚Šé–“éš”ï¼ˆé–‹å§‹å‰ãƒ»çµ‚äº†å¾Œã‚‚å«ã‚€ï¼‰: ${maxInterval} å£\n`;
      } else {
        resultText += "âš ï¸ é–“éš”ã®è¨ˆç®—ä¸å¯ï¼ˆå½“ãŸã‚Š1ä»¶ä»¥ä¸‹ï¼‰\n";
      }

      if (forceStartIndex !== null) {
        resultText += `ğŸš¨ å¼·åˆ¶æ’å‡ºã‚¹ã‚¿ãƒ¼ãƒˆ: ${forceStartIndex} å£ç›®\n`;
        resultText += `ğŸ§® å¼·åˆ¶æ’å‡ºã§å‡ºãŸå½“ãŸã‚Š: ${forcedWinCount} å£\n`;
      } else {
        resultText += `âœ… å¼·åˆ¶æ’å‡ºã¯ç™ºå‹•ã—ãªã‹ã£ãŸ\n`;
      }

      let detailsHTML = '';
      if (winIndexes.length > 0) {
        const indexList = winIndexes.map((n, i) => `${i + 1}å›ç›®ï¼š${n}å£ç›®`).join('\n');
        detailsHTML = `
<details>
  <summary>ğŸ“‹ å½“ãŸã£ãŸå ´æ‰€ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆ${winIndexes.length} ä»¶ï¼‰</summary>
  <pre>${indexList}</pre>
</details>`;
      }

      document.getElementById("resultArea").innerHTML = resultText + detailsHTML;
    }
  </script>
</body>
</html>
